webpackJsonp([104],{1957:function(n,t,l){"use strict";function e(n){return d._57(0,[(n()(),d._31(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),d._30(1,16384,[[3,4]],0,z.a,[Q.a,d.t,d.V,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),d._55(2,null,["",""])),d._47(131072,W.a,[X.a,d.j])],function(n,t){n(t,1,0,"addon-data-groupslabel")},function(n,t){n(t,2,0,d._56(t,2,0,d._44(t,3).transform("core.groupsseparate")))})}function a(n){return d._57(0,[(n()(),d._31(0,0,null,null,3,"ion-label",[["id","addon-data-groupslabel"]],null,null,null,null,null)),d._30(1,16384,[[3,4]],0,z.a,[Q.a,d.t,d.V,[8,null],[8,null],[8,null],[8,null]],{id:[0,"id"]},null),(n()(),d._55(2,null,["",""])),d._47(131072,W.a,[X.a,d.j])],function(n,t){n(t,1,0,"addon-data-groupslabel")},function(n,t){n(t,2,0,d._56(t,2,0,d._44(t,3).transform("core.groupsvisible")))})}function i(n){return d._57(0,[(n()(),d._31(0,0,null,null,2,"ion-option",[],null,null,null,null,null)),d._30(1,16384,[[6,4]],0,Z.a,[d.t],{value:[0,"value"]},null),(n()(),d._55(2,null,["",""]))],function(n,t){n(t,1,0,t.context.$implicit.id)},function(n,t){n(t,2,0,t.context.$implicit.name)})}function r(n){return d._57(0,[(n()(),d._31(0,0,null,null,24,"ion-item",[["class","item item-block"],["text-wrap",""]],null,null,null,nn.b,nn.a)),d._30(1,1097728,null,3,tn.a,[ln.a,Q.a,d.t,d.V,[2,en.a]],null,null),d._52(603979776,3,{contentLabel:0}),d._52(603979776,4,{_buttons:1}),d._52(603979776,5,{_icons:1}),d._30(5,16384,null,0,an.a,[],null,null),(n()(),d._55(-1,2,["\n            "])),(n()(),d._26(16777216,null,1,1,null,e)),d._30(8,16384,null,0,rn.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,2,["\n            "])),(n()(),d._26(16777216,null,1,1,null,a)),d._30(11,16384,null,0,rn.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,2,["\n            "])),(n()(),d._31(13,0,null,3,10,"ion-select",[["aria-labelledby","addon-data-groupslabel"],["interface","action-sheet"]],[[2,"select-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"ionChange"],[null,"click"],[null,"keyup.space"]],function(n,t,l){var e=!0,a=n.component;if("click"===t){e=!1!==d._44(n,14)._click(l)&&e}if("keyup.space"===t){e=!1!==d._44(n,14)._keyup()&&e}if("ngModelChange"===t){e=!1!==(a.selectedGroup=l)&&e}if("ionChange"===t){e=!1!==a.setGroup(a.selectedGroup)&&e}return e},on.b,on.a)),d._30(14,1228800,null,1,un.a,[dn.a,ln.a,Q.a,d.t,d.V,[2,tn.a],sn.a],{interface:[0,"interface"]},{ionChange:"ionChange"}),d._52(603979776,6,{options:1}),d._50(1024,null,m.l,function(n){return[n]},[un.a]),d._30(17,671744,null,0,m.q,[[8,null],[8,null],[8,null],[2,m.l]],{model:[0,"model"]},{update:"ngModelChange"}),d._50(2048,null,m.m,null,[m.q]),d._30(19,16384,null,0,m.n,[m.m],null,null),(n()(),d._55(-1,null,["\n                "])),(n()(),d._26(16777216,null,null,1,null,i)),d._30(22,802816,null,0,rn.j,[d._11,d._6,d.E],{ngForOf:[0,"ngForOf"]},null),(n()(),d._55(-1,null,["\n            "])),(n()(),d._55(-1,2,["\n        "]))],function(n,t){var l=t.component;n(t,8,0,l.groupInfo.separateGroups);n(t,11,0,l.groupInfo.visibleGroups);n(t,14,0,"action-sheet");n(t,17,0,l.selectedGroup);n(t,22,0,l.groupInfo.groups)},function(n,t){n(t,13,0,d._44(t,14)._disabled,d._44(t,19).ngClassUntouched,d._44(t,19).ngClassTouched,d._44(t,19).ngClassPristine,d._44(t,19).ngClassDirty,d._44(t,19).ngClassValid,d._44(t,19).ngClassInvalid,d._44(t,19).ngClassPending)})}function o(n){return d._57(0,[(n()(),d._31(0,0,null,null,14,"div",[],[[8,"className",0]],null,null,null,null)),(n()(),d._55(-1,null,["\n            "])),(n()(),d._31(2,0,null,null,1,"core-style",[],null,null,null,cn.b,cn.a)),d._30(3,573440,null,0,fn.a,[d.t],{css:[0,"css"],prefix:[1,"prefix"]},null),(n()(),d._55(-1,null,["\n\n            "])),(n()(),d._31(5,0,null,null,8,"form",[["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngSubmit"],[null,"submit"],[null,"reset"]],function(n,t,l){var e=!0,a=n.component;if("submit"===t){e=!1!==d._44(n,7).onSubmit(l)&&e}if("reset"===t){e=!1!==d._44(n,7).onReset()&&e}if("ngSubmit"===t){e=!1!==a.save(l)&&e}return e},null,null)),d._30(6,16384,null,0,m.w,[],null,null),d._30(7,540672,null,0,m.h,[[8,null],[8,null]],{form:[0,"form"]},{ngSubmit:"ngSubmit"}),d._50(2048,null,m.b,null,[m.h]),d._30(9,16384,null,0,m.o,[m.b],null,null),(n()(),d._55(-1,null,["\n                "])),(n()(),d._31(11,0,null,null,1,"core-compile-html",[],null,null,null,_n.b,_n.a)),d._30(12,966656,null,0,pn.a,[hn.a,d.j,d.t,[2,gn.a],d.F,v.a,y.a],{text:[0,"text"],jsData:[1,"jsData"],extraImports:[2,"extraImports"]},null),(n()(),d._55(-1,null,["\n            "])),(n()(),d._55(-1,null,["\n        "]))],function(n,t){var l=t.component;n(t,3,0,l.data.csstemplate,d._34(1,".addon-data-entries-",l.data.id,""));n(t,7,0,l.editForm);n(t,12,0,l.editFormRender,l.jsData,l.extraImports)},function(n,t){n(t,0,0,d._34(1,"addon-data-contents addon-data-entries-",t.component.data.id,""));n(t,5,0,d._44(t,9).ngClassUntouched,d._44(t,9).ngClassTouched,d._44(t,9).ngClassPristine,d._44(t,9).ngClassDirty,d._44(t,9).ngClassValid,d._44(t,9).ngClassInvalid,d._44(t,9).ngClassPending)})}function u(n){return d._57(0,[d._52(402653184,1,{content:0}),(n()(),d._31(1,0,null,null,23,"ion-header",[],null,null,null,null,null)),d._30(2,16384,null,0,mn.a,[Q.a,d.t,d.V,[2,yn.a]],null,null),(n()(),d._55(-1,null,["\n    "])),(n()(),d._31(4,0,null,null,19,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,vn.b,vn.a)),d._30(5,49152,null,0,bn.a,[dn.a,[2,yn.a],[2,gn.a],Q.a,d.t,d.V],null,null),d._30(6,212992,null,0,In.a,[bn.a,Cn.a,X.a,C.a],null,null),(n()(),d._55(-1,3,["\n        "])),(n()(),d._31(8,0,null,3,3,"ion-title",[],null,null,null,Pn.b,Pn.a)),d._30(9,49152,null,0,En.a,[Q.a,d.t,d.V,[2,Dn.a],[2,bn.a]],null,null),(n()(),d._31(10,0,null,0,1,"core-format-text",[],null,null,null,null,null)),d._30(11,540672,null,0,jn.a,[d.t,b.a,v.a,Fn.a,X.a,Cn.a,y.a,An.a,Tn.a,On.a,xn.a,Gn.a,[2,gn.a],[2,wn.a],[2,Rn.a],kn.a,C.a],{text:[0,"text"]},null),(n()(),d._55(-1,3,["\n        "])),(n()(),d._31(13,0,null,2,9,"ion-buttons",[["end",""]],null,null,null,null,null)),d._30(14,16384,null,1,Un.a,[Q.a,d.t,d.V,[2,Dn.a],[2,bn.a]],null,null),d._52(603979776,2,{_buttons:1}),(n()(),d._55(-1,null,["\n            "])),(n()(),d._31(17,0,null,null,4,"button",[["clear",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,t,l){var e=!0;if("click"===t){e=!1!==n.component.save(l)&&e}return e},Vn.b,Vn.a)),d._30(18,1097728,[[2,4]],0,Hn.a,[[8,""],Q.a,d.t,d.V],{clear:[0,"clear"]},null),d._47(131072,W.a,[X.a,d.j]),(n()(),d._55(20,0,["\n                ","\n            "])),d._47(131072,W.a,[X.a,d.j]),(n()(),d._55(-1,null,["\n        "])),(n()(),d._55(-1,3,["\n    "])),(n()(),d._55(-1,null,["\n"])),(n()(),d._55(-1,null,["\n"])),(n()(),d._31(26,0,null,null,12,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Mn.b,Mn.a)),d._30(27,4374528,[[1,4]],0,wn.a,[Q.a,Cn.a,Ln.a,d.t,d.V,dn.a,Sn.a,d.M,[2,yn.a],[2,gn.a]],null,null),(n()(),d._55(-1,1,["\n    "])),(n()(),d._31(29,0,null,1,8,"core-loading",[],null,null,null,Nn.b,Nn.a)),d._30(30,638976,null,0,$n.a,[X.a,d.t,C.a,y.a],{hideUntil:[0,"hideUntil"]},null),(n()(),d._55(-1,0,["\n        "])),(n()(),d._26(16777216,null,0,1,null,r)),d._30(33,16384,null,0,rn.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,0,["\n\n        "])),(n()(),d._26(16777216,null,0,1,null,o)),d._30(36,16384,null,0,rn.k,[d._11,d._6],{ngIf:[0,"ngIf"]},null),(n()(),d._55(-1,0,["\n    "])),(n()(),d._55(-1,1,["\n"])),(n()(),d._55(-1,null,["\n"]))],function(n,t){var l=t.component;n(t,6,0);n(t,11,0,l.title);n(t,18,0,"");n(t,30,0,l.loaded);n(t,33,0,l.groupInfo&&(l.groupInfo.separateGroups||l.groupInfo.visibleGroups));n(t,36,0,l.data)},function(n,t){n(t,4,0,d._44(t,5)._hidden,d._44(t,5)._sbPadding);n(t,17,0,d._56(t,17,0,d._44(t,19).transform("core.save")));n(t,20,0,d._56(t,20,0,d._44(t,21).transform("core.save")));n(t,26,0,d._44(t,27).statusbarPadding,d._44(t,27)._hasRefresher)})}Object.defineProperty(t,"__esModule",{value:!0});var d=l(0),s=l(8),c=l(3),f=l(29),_=l(24),p=l(353),h=l(451),g=l(450),m=l(21),y=l(2),v=l(4),b=l(1),I=l(68),C=l(12),P=l(66),E=l(15),D=l(98),j=l(259),F=l(212),A=l(118),T=this&&this.__decorate||function(n,t,l,e){var a,i=arguments.length,r=i<3?t:null===e?e=Object.getOwnPropertyDescriptor(t,l):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,l,e);else for(var o=n.length-1;o>=0;o--)(a=n[o])&&(r=(i<3?a(r):i>3?a(t,l,r):a(t,l))||r);return i>3&&r&&Object.defineProperty(t,l,r),r},O=this&&this.__metadata||function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)},x=function(){function n(n,t,l,e,a,i,r,o,u,d,s,c,f,_){this.utils=t,this.groupsProvider=l,this.domUtils=e,this.fieldsDelegate=a,this.courseProvider=i,this.dataProvider=r,this.dataOffline=o,this.dataHelper=u,this.navCtrl=s,this.translate=c,this.eventsProvider=f,this.fileUploaderProvider=_,this.offlineActions=[],this.fields={},this.fieldsArray=[],this.forceLeave=!1,this.title="",this.component=D.a.COMPONENT,this.loaded=!1,this.selectedGroup=0,this.cssClass="",this.editFormRender="",this.extraImports=[g.a],this.errors={},this.module=n.get("module")||{},this.entryId=n.get("entryId")||null,this.courseId=n.get("courseId"),this.selectedGroup=n.get("group")||0,this.siteId=d.getCurrentSiteId(),this.title=this.module.name,this.editForm=new m.g({})}return n.prototype.ionViewDidLoad=function(){this.fetchEntryData()},n.prototype.ionViewCanLeave=function(){var n=this;if(this.forceLeave)return!0;var t=this.editForm.value;return this.dataHelper.hasEditDataChanged(t,this.fieldsArray,this.data.id,this.entry.contents).then(function(t){return t?n.domUtils.showConfirm(n.translate.instant("core.confirmcanceledit")):Promise.resolve()}).then(function(){return n.dataHelper.getEditTmpFiles(t,n.fieldsArray,n.data.id,n.entry.contents).then(function(t){n.fileUploaderProvider.clearTmpFiles(t)})})},n.prototype.fetchEntryData=function(){var n=this;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(t){return n.title=t.name||n.title,n.data=t,n.cssClass="addon-data-entries-"+t.id,n.dataProvider.getDatabaseAccessInformation(t.id)}).then(function(t){if(n.entryId)return n.groupsProvider.getActivityGroupInfo(n.data.coursemodule,t.canmanageentries).then(function(t){n.groupInfo=t,t&&t.groups&&t.groups.length>0&&(t.groups.some(function(t){return n.selectedGroup==t.id})||(n.selectedGroup=t.groups[0].id))})}).then(function(){return n.dataOffline.getEntryActions(n.data.id,n.entryId)}).then(function(t){return n.offlineActions=t,n.dataProvider.getFields(n.data.id)}).then(function(t){return n.fieldsArray=t,n.fields=n.utils.arrayToObject(t,"id"),n.dataHelper.getEntry(n.data,n.entryId,n.offlineActions)}).then(function(t){return t?(t=t.entry).contents=n.utils.arrayToObject(t.contents,"fieldid"):t={contents:{}},n.dataHelper.applyOfflineActions(t,n.offlineActions,n.fieldsArray)}).then(function(t){n.entry=t,n.editFormRender=n.displayEditFields()}).catch(function(t){n.domUtils.showErrorModalDefault(t,"core.course.errorgetmodule",!0)}).finally(function(){n.loaded=!0})},n.prototype.save=function(n){var t=this;n.preventDefault(),n.stopPropagation();var l=this.editForm.value;return this.dataHelper.hasEditDataChanged(l,this.fieldsArray,this.data.id,this.entry.contents).then(function(n){if(!n)return t.entryId?t.returnToEntryList():Promise.reject("addon.mod_data.emptyaddform");var e=t.domUtils.showModalLoading("core.sending",!0),a=t.entryId?t.entryId:-(new Date).getTime();return t.dataHelper.getEditDataFromForm(l,t.fieldsArray,t.data.id,a,t.entry.contents,t.offline).catch(function(n){return t.offline?Promise.reject(n):(t.offline=!0,t.dataHelper.getEditDataFromForm(l,t.fieldsArray,t.data.id,a,t.entry.contents,t.offline))}).then(function(n){return n.length>0&&(t.entryId?t.dataProvider.editEntry(t.data.id,t.entryId,t.courseId,n,t.fields,void 0,t.offline):t.dataProvider.addEntry(t.data.id,a,t.courseId,n,t.selectedGroup,t.fields,void 0,t.offline))}).then(function(n){if(!n)return Promise.reject("addon.mod_data.emptyaddform");if(t.entryId&&n.updated||!t.entryId&&n.newentryid){var l=[];return t.entryId=t.entryId||n.newentryid,l.push(t.dataProvider.invalidateEntryData(t.data.id,t.entryId,t.siteId)),l.push(t.dataProvider.invalidateEntriesData(t.data.id,t.siteId)),Promise.all(l).then(function(){t.eventsProvider.trigger(D.a.ENTRY_CHANGED,{dataId:t.data.id,entryId:t.entryId},t.siteId)}).finally(function(){return t.returnToEntryList()})}t.errors={},n.fieldnotifications&&n.fieldnotifications.forEach(function(n){var l=t.fieldsArray.find(function(t){return t.name==n.fieldname});l&&(t.errors[l.id]=n.notification)}),t.jsData.errors=t.errors,setTimeout(function(){t.scrollToFirstError()})}).finally(function(){e.dismiss()})}).catch(function(n){t.domUtils.showErrorModalDefault(n,"Cannot edit entry",!0)})},n.prototype.setGroup=function(n){return this.selectedGroup=n,this.loaded=!1,this.fetchEntryData()},n.prototype.displayEditFields=function(){this.jsData={fields:this.fields,contents:this.utils.clone(this.entry.contents),form:this.editForm,data:this.data,errors:this.errors};var n,t=this.data.addtemplate||this.dataHelper.getDefaultTemplate("add",this.fieldsArray);return this.fieldsArray.forEach(function(l){n=(n="[["+l.name+"]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),t=t.replace(n,'<addon-mod-data-field-plugin mode="edit" [field]="fields['+l.id+']"                [value]="contents['+l.id+']" [form]="form" [database]="data" [error]="errors['+l.id+']">                </addon-mod-data-field-plugin>'),n=(n="[["+l.name+"#id]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),n=new RegExp(n,"gi"),t=t.replace(n,"field_"+l.id)}),t},n.prototype.returnToEntryList=function(){var n=this;return this.dataHelper.getEditTmpFiles(this.editForm.value,this.fieldsArray,this.data.id,this.entry.contents).then(function(t){n.fileUploaderProvider.clearTmpFiles(t)}).finally(function(){n.forceLeave=!0,n.navCtrl.pop()})},n.prototype.scrollToFirstError=function(){this.domUtils.scrollToElementBySelector(this.content,".addon-data-error")||this.domUtils.scrollToTop(this.content)},T([Object(d._9)(s.f),O("design:type",s.f)],n.prototype,"content",void 0),n=T([Object(d.m)({selector:"page-addon-mod-data-edit",templateUrl:"edit.html"}),O("design:paramtypes",[s.t,y.a,I.a,v.a,A.a,E.a,D.a,F.a,j.a,b.a,s.s,c.c,C.a,P.a])],n)}(),G=this&&this.__decorate||function(n,t,l,e){var a,i=arguments.length,r=i<3?t:null===e?e=Object.getOwnPropertyDescriptor(t,l):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(n,t,l,e);else for(var o=n.length-1;o>=0;o--)(a=n[o])&&(r=(i<3?a(r):i>3?a(t,l,r):a(t,l))||r);return i>3&&r&&Object.defineProperty(t,l,r),r},w=function(){function n(){}return n=G([Object(d.I)({declarations:[x],imports:[f.a,_.a,g.a,h.a,p.a,s.l.forChild(x),c.b.forChild()]})],n)}(),R=l(1365),k=l(1366),U=l(1367),V=l(1368),H=l(1369),M=l(1370),L=l(1371),S=l(1372),N=l(1373),$=l(1376),q=l(1377),B=l(1378),J=l(1379),K=l(455),Y=l(1392),z=l(60),Q=l(6),W=l(27),X=l(18),Z=l(93),nn=l(30),tn=l(20),ln=l(19),en=l(28),an=l(33),rn=l(7),on=l(115),un=l(94),dn=l(32),sn=l(52),cn=l(1424),fn=l(462),_n=l(201),pn=l(174),hn=l(138),gn=l(22),mn=l(447),yn=l(37),vn=l(1374),bn=l(206),In=l(676),Cn=l(14),Pn=l(1375),En=l(350),Dn=l(253),jn=l(41),Fn=l(10),An=l(26),Tn=l(5),On=l(16),xn=l(9),Gn=l(17),wn=l(25),Rn=l(34),kn=l(36),Un=l(448),Vn=l(46),Hn=l(43),Mn=l(178),Ln=l(31),Sn=l(104),Nn=l(49),$n=l(48),qn=l(63),Bn=d._29({encapsulation:2,styles:[],data:{}}),Jn=d._27("page-addon-mod-data-edit",x,function(n){return d._57(0,[(n()(),d._31(0,0,null,null,1,"page-addon-mod-data-edit",[],null,null,null,u,Bn)),d._30(1,49152,null,0,x,[qn.a,y.a,I.a,v.a,A.a,E.a,D.a,F.a,j.a,b.a,gn.a,X.a,C.a,P.a],null,null)],null,null)},{},{},[]),Kn=l(346),Yn=l(347),zn=l(349),Qn=l(348),Wn=l(446),Xn=l(675),Zn=l(103),nt=l(67),tt=l(254);l.d(t,"AddonModDataEditPageModuleNgFactory",function(){return lt});var lt=d._28(w,[],function(n){return d._40([d._41(512,d.o,d._21,[[8,[R.a,k.a,U.a,V.a,H.a,M.a,L.a,S.a,N.a,$.a,q.a,B.a,J.a,K.a,Y.a,Jn]],[3,d.o],d.K]),d._41(4608,rn.m,rn.l,[d.G,[2,rn.v]]),d._41(4608,m.x,m.x,[]),d._41(4608,m.d,m.d,[]),d._41(4608,Kn.b,Kn.a,[]),d._41(4608,Yn.a,Yn.b,[]),d._41(4608,zn.b,zn.a,[]),d._41(4608,Qn.b,Qn.a,[]),d._41(4608,X.a,X.a,[Wn.a,Kn.b,Yn.a,zn.b,Qn.b,X.b,X.c]),d._41(512,f.a,f.a,[]),d._41(512,rn.b,rn.b,[]),d._41(512,m.v,m.v,[]),d._41(512,m.i,m.i,[]),d._41(512,m.s,m.s,[]),d._41(512,Xn.a,Xn.a,[]),d._41(512,c.b,c.b,[]),d._41(512,Zn.a,Zn.a,[]),d._41(512,_.a,_.a,[]),d._41(512,nt.a,nt.a,[]),d._41(512,h.a,h.a,[]),d._41(512,p.a,p.a,[]),d._41(512,g.a,g.a,[]),d._41(512,Xn.b,Xn.b,[]),d._41(512,w,w,[]),d._41(256,X.c,void 0,[]),d._41(256,X.b,void 0,[]),d._41(256,tt.a,x,[])])})}});