webpackJsonp([125],{1857:function(n,t,l){"use strict";function e(n){return f._42(0,[(n()(),f._16(0,0,null,null,6,"button",[["icon-only",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,t,l){var e=!0;if("click"===t){e=!1!==n.component.openCourseFilter(l)&&e}return e},V.b,V.a)),f._15(1,1097728,[[3,4]],0,Y.a,[[8,""],z.a,f.p,f.K],null,null),f._32(131072,B.a,[G.a,f.i]),(n()(),f._40(-1,0,["\n                "])),(n()(),f._16(4,0,null,0,1,"ion-icon",[["name","funnel"],["role","img"]],[[2,"hide",null]],null,null,null,null)),f._15(5,147456,null,0,J.a,[z.a,f.p,f.K],{name:[0,"name"]},null),(n()(),f._40(-1,0,["\n            "]))],function(n,t){n(t,5,0,"funnel")},function(n,t){n(t,0,0,f._41(t,0,0,f._29(t,2).transform("core.courses.filter")));n(t,4,0,f._29(t,5)._hidden)})}function i(n){return f._42(0,[(n()(),f._16(0,0,null,null,3,"core-empty-box",[["icon","calendar"]],null,null,null,q.b,q.a)),f._15(1,49152,null,0,Q.a,[],{message:[0,"message"],icon:[1,"icon"]},null),f._32(131072,B.a,[G.a,f.i]),(n()(),f._40(-1,0,["\n            "]))],function(n,t){n(t,1,0,f._41(t,1,0,f._29(t,2).transform("addon.calendar.noevents")),"calendar")},null)}function a(n){return f._42(0,[(n()(),f._16(0,0,null,null,7,"ion-item-divider",[["class","item item-divider"]],null,null,null,X.b,X.a)),f._15(1,1097728,null,3,Z.a,[nn.a,z.a,f.p,f.K,[2,tn.a]],null,null),f._37(335544320,4,{contentLabel:0}),f._37(603979776,5,{_buttons:1}),f._37(603979776,6,{_icons:1}),f._15(5,16384,null,0,ln.a,[z.a,f.p,f.K],null,null),(n()(),f._40(6,2,["\n                        ","\n                    "])),f._34(7,2)],null,function(n,t){n(t,6,0,f._41(t,6,0,n(t,7,0,f._29(t.parent.parent.parent,0),1e3*t.parent.context.$implicit.timestart,"strftimedayshort")))})}function u(n){return f._42(0,[(n()(),f._16(0,0,null,null,0,"img",[["class","core-module-icon"],["item-start",""]],[[8,"src",4]],null,null,null,null))],null,function(n,t){n(t,0,0,f._19(1,"",t.parent.context.$implicit.moduleIcon,""))})}function o(n){return f._42(0,[(n()(),f._16(0,0,null,null,1,"core-icon",[["item-start",""]],null,null,null,en.b,en.a)),f._15(1,245760,null,0,an.a,[f.p],{name:[0,"name"]},null)],function(n,t){n(t,1,0,t.parent.context.$implicit.icon)},null)}function r(n){return f._42(0,[(n()(),f._16(0,0,null,null,2,"span",[],null,null,null,null,null)),(n()(),f._40(1,null,[" - ",""])),f._34(2,2)],null,function(n,t){n(t,1,0,f._41(t,1,0,n(t,2,0,f._29(t.parent.parent.parent,0),1e3*(t.parent.context.$implicit.timestart+t.parent.context.$implicit.timeduration),"strftimetime")))})}function s(n){return f._42(0,[(n()(),f._16(0,0,null,null,2,"span",[],null,null,null,null,null)),(n()(),f._40(1,null,[" - ",""])),f._34(2,2)],null,function(n,t){n(t,1,0,f._41(t,1,0,n(t,2,0,f._29(t.parent.parent.parent,0),1e3*(t.parent.context.$implicit.timestart+t.parent.context.$implicit.timeduration),"strftimedatetimeshort")))})}function c(n){return f._42(0,[(n()(),f._16(0,0,null,null,32,null,null,null,null,null,null,null)),(n()(),f._40(-1,null,["\n                    "])),(n()(),f._11(16777216,null,null,1,null,a)),f._15(3,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,null,["\n                    "])),(n()(),f._16(5,0,null,null,26,"a",[["class","item item-block"],["ion-item",""],["text-wrap",""]],[[8,"title",0],[2,"core-split-item-selected",null]],[[null,"click"]],function(n,t,l){var e=!0;if("click"===t){e=!1!==n.component.gotoEvent(n.context.$implicit.id)&&e}return e},X.b,X.a)),f._15(6,1097728,null,3,Z.a,[nn.a,z.a,f.p,f.K,[2,tn.a]],null,null),f._37(335544320,7,{contentLabel:0}),f._37(603979776,8,{_buttons:1}),f._37(603979776,9,{_icons:1}),f._15(10,16384,null,0,on.a,[],null,null),(n()(),f._40(-1,2,["\n                        "])),(n()(),f._11(16777216,null,0,1,null,u)),f._15(13,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,2,["\n                        "])),(n()(),f._11(16777216,null,0,1,null,o)),f._15(16,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,2,["\n                        "])),(n()(),f._16(18,0,null,2,2,"h2",[],null,null,null,null,null)),(n()(),f._16(19,0,null,null,1,"core-format-text",[],null,null,null,null,null)),f._15(20,540672,null,0,rn.a,[f.p,C.a,E.a,sn.a,G.a,cn.a,I.a,dn.a,_n.a,fn.a,L.a,pn.a,[2,hn.a],[2,mn.a],[2,$.a],vn.a,T.a],{text:[0,"text"]},null),(n()(),f._40(-1,2,["\n                        "])),(n()(),f._16(22,0,null,2,8,"p",[],null,null,null,null,null)),(n()(),f._40(23,null,["\n                            ","\n                            "])),f._34(24,2),(n()(),f._11(16777216,null,null,1,null,r)),f._15(26,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,null,["\n                            "])),(n()(),f._11(16777216,null,null,1,null,s)),f._15(29,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,null,["\n                        "])),(n()(),f._40(-1,2,["\n                    "])),(n()(),f._40(-1,null,["\n                "]))],function(n,t){n(t,3,0,t.context.$implicit.showDate);n(t,13,0,t.context.$implicit.moduleIcon);n(t,16,0,t.context.$implicit.icon&&!t.context.$implicit.moduleIcon);n(t,20,0,t.context.$implicit.name);n(t,26,0,t.context.$implicit.timeduration&&t.context.$implicit.endsSameDay);n(t,29,0,t.context.$implicit.timeduration&&!t.context.$implicit.endsSameDay)},function(n,t){n(t,5,0,t.context.$implicit.name,t.context.$implicit.id==t.component.eventId);n(t,23,0,f._41(t,23,0,n(t,24,0,f._29(t.parent.parent,0),1e3*t.context.$implicit.timestart,"strftimetime")))})}function d(n){return f._42(0,[(n()(),f._16(0,0,null,null,5,"ion-list",[["no-margin",""]],null,null,null,null,null)),f._15(1,16384,null,0,gn.a,[z.a,f.p,f.K,cn.a,bn.l,yn.a],null,null),(n()(),f._40(-1,null,["\n                "])),(n()(),f._11(16777216,null,null,1,null,c)),f._15(4,802816,null,0,un.j,[f.W,f.T,f.v],{ngForOf:[0,"ngForOf"]},null),(n()(),f._40(-1,null,["\n            "]))],function(n,t){n(t,4,0,t.component.filteredEvents)},null)}function _(n){return f._42(0,[f._32(0,En.a,[_n.a,In.a]),f._37(402653184,1,{content:0}),f._37(402653184,2,{splitviewCtrl:0}),(n()(),f._16(3,0,null,null,28,"ion-header",[],null,null,null,null,null)),f._15(4,16384,null,0,Cn.a,[z.a,f.p,f.K,[2,xn.a]],null,null),(n()(),f._40(-1,null,["\n    "])),(n()(),f._16(6,0,null,null,24,"ion-navbar",[["class","toolbar"],["core-back-button",""]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,Dn.b,Dn.a)),f._15(7,49152,null,0,Tn.a,[Ln.a,[2,xn.a],[2,hn.a],z.a,f.p,f.K],null,null),f._15(8,212992,null,0,$n.a,[Tn.a,cn.a,G.a,T.a],null,null),(n()(),f._40(-1,3,["\n        "])),(n()(),f._16(10,0,null,3,3,"ion-title",[],null,null,null,kn.b,kn.a)),f._15(11,49152,null,0,Pn.a,[z.a,f.p,f.K,[2,Sn.a],[2,Tn.a]],null,null),(n()(),f._40(12,0,["",""])),f._32(131072,B.a,[G.a,f.i]),(n()(),f._40(-1,3,["\n        "])),(n()(),f._16(15,0,null,2,14,"ion-buttons",[["end",""]],null,null,null,null,null)),f._15(16,16384,null,1,An.a,[z.a,f.p,f.K,[2,Sn.a],[2,Tn.a]],null,null),f._37(603979776,3,{_buttons:1}),(n()(),f._40(-1,null,["\n            "])),(n()(),f._11(16777216,null,null,1,null,e)),f._15(20,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,null,["\n            "])),(n()(),f._16(22,0,null,null,6,"core-context-menu",[],null,null,null,Mn.b,Mn.a)),f._15(23,245760,null,0,wn.a,[G.a,Rn.a,f.p,E.a,[2,Kn.a],I.a],null,null),(n()(),f._40(-1,0,["\n                "])),(n()(),f._16(25,0,null,0,2,"core-context-menu-item",[],null,[[null,"action"]],function(n,t,l){var e=!0;if("action"===t){e=!1!==n.component.openSettings()&&e}return e},Fn.b,Fn.a)),f._15(26,770048,null,0,Wn.a,[wn.a],{content:[0,"content"],iconAction:[1,"iconAction"],priority:[2,"priority"],hidden:[3,"hidden"]},{action:"action"}),f._32(131072,B.a,[G.a,f.i]),(n()(),f._40(-1,0,["\n            "])),(n()(),f._40(-1,null,["\n        "])),(n()(),f._40(-1,3,["\n    "])),(n()(),f._40(-1,null,["\n"])),(n()(),f._40(-1,null,["\n"])),(n()(),f._16(33,0,null,null,27,"core-split-view",[],null,null,null,Nn.b,Nn.a)),f._15(34,245760,[[2,4]],0,$.a,[[2,hn.a],f.p,On.a,cn.a,G.a],null,null),(n()(),f._40(-1,0,["\n    "])),(n()(),f._16(36,0,null,0,23,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,Hn.b,Hn.a)),f._15(37,4374528,[[1,4]],0,mn.a,[z.a,cn.a,yn.a,f.p,f.K,Ln.a,Un.a,f.D,[2,xn.a],[2,hn.a]],null,null),(n()(),f._40(-1,1,["\n        "])),(n()(),f._16(39,0,null,2,6,"ion-refresher",[],[[2,"refresher-active",null],[4,"top",null]],[[null,"ionRefresh"]],function(n,t,l){var e=!0;if("ionRefresh"===t){e=!1!==n.component.refreshEvents(l)&&e}return e},null,null)),f._15(40,212992,null,0,jn.a,[cn.a,mn.a,f.D,bn.l],{enabled:[0,"enabled"]},{ionRefresh:"ionRefresh"}),(n()(),f._40(-1,null,["\n            "])),(n()(),f._16(42,0,null,null,2,"ion-refresher-content",[],[[1,"state",0]],null,null,Vn.b,Vn.a)),f._15(43,114688,null,0,Yn.a,[jn.a,z.a],{pullingText:[0,"pullingText"]},null),f._32(131072,B.a,[G.a,f.i]),(n()(),f._40(-1,null,["\n        "])),(n()(),f._40(-1,1,["\n        "])),(n()(),f._16(47,0,null,1,11,"core-loading",[],null,null,null,zn.b,zn.a)),f._15(48,638976,null,0,Bn.a,[G.a,f.p,T.a,I.a],{hideUntil:[0,"hideUntil"]},null),(n()(),f._40(-1,0,["\n            "])),(n()(),f._11(16777216,null,0,1,null,i)),f._15(51,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,0,["\n\n            "])),(n()(),f._11(16777216,null,0,1,null,d)),f._15(54,16384,null,0,un.k,[f.W,f.T],{ngIf:[0,"ngIf"]},null),(n()(),f._40(-1,0,["\n\n            "])),(n()(),f._16(56,0,null,0,1,"core-infinite-loading",[],null,[[null,"action"]],function(n,t,l){var e=!0;if("action"===t){e=!1!==n.component.loadMoreEvents(l)&&e}return e},Gn.b,Gn.a)),f._15(57,573440,null,0,Jn.a,[[2,mn.a]],{enabled:[0,"enabled"],error:[1,"error"]},{action:"action"}),(n()(),f._40(-1,0,["\n        "])),(n()(),f._40(-1,1,["\n    "])),(n()(),f._40(-1,0,["\n"]))],function(n,t){var l=t.component;n(t,8,0);n(t,20,0,l.courses&&l.courses.length),n(t,23,0);n(t,26,0,f._41(t,26,0,f._29(t,27).transform("core.settings.settings")),"cog",600,!l.notificationsEnabled),n(t,34,0);n(t,40,0,l.eventsLoaded);n(t,43,0,f._19(1,"",f._41(t,43,0,f._29(t,44).transform("core.pulltorefresh")),""));n(t,48,0,l.eventsLoaded);n(t,51,0,!l.filteredEvents||!l.filteredEvents.length);n(t,54,0,l.filteredEvents&&l.filteredEvents.length);n(t,57,0,l.canLoadMore,l.loadMoreError)},function(n,t){n(t,6,0,f._29(t,7)._hidden,f._29(t,7)._sbPadding);n(t,12,0,f._41(t,12,0,f._29(t,13).transform("addon.calendar.calendarevents")));n(t,36,0,f._29(t,37).statusbarPadding,f._29(t,37)._hasRefresher);n(t,39,0,"inactive"!==f._29(t,40).state,f._29(t,40)._top);n(t,42,0,f._29(t,43).r.state)})}Object.defineProperty(t,"__esModule",{value:!0});var f=l(1),p=(l(0),l(9),l(4)),h=l(25),m=l(30),v=l(104),g=l(357),b=l(687),y=l(51),E=l(5),I=l(3),C=l(2),x=l(142),D=l(720),T=l(13),L=l(10),$=l(35),k=l(14),P=function(){function n(n,t,l,e,i,a,u,o,r,s,c,d,_){var f=this;this.translate=n,this.calendarProvider=t,this.domUtils=e,this.coursesProvider=i,this.utils=a,this.calendarHelper=u,this.popoverCtrl=s,this.navCtrl=d,this.daysLoaded=0,this.emptyEventsTimes=0,this.categoriesRetrieved=!1,this.getCategories=!1,this.allCourses={id:-1,fullname:this.translate.instant("core.fulllistofcourses"),category:-1},this.categories={},this.eventsLoaded=!1,this.events=[],this.notificationsEnabled=!1,this.filteredEvents=[],this.canLoadMore=!1,this.loadMoreError=!1,this.filter={course:this.allCourses},this.siteHomeId=o.getCurrentSite().getSiteHomeId(),this.notificationsEnabled=r.isAvailable(),this.notificationsEnabled&&(this.obsDefaultTimeChange=c.on(g.a.DEFAULT_NOTIFICATION_TIME_CHANGED,function(){t.scheduleEventsNotifications(f.events)},o.getCurrentSiteId())),this.eventId=l.get("eventId")||!1}return n.prototype.ionViewDidLoad=function(){var n=this;this.eventId&&this.gotoEvent(this.eventId),this.fetchData().then(function(){!n.eventId&&n.splitviewCtrl.isOn()&&n.events.length>0&&n.gotoEvent(n.events[0].id)}).finally(function(){n.eventsLoaded=!0})},n.prototype.fetchData=function(n){var t=this;return void 0===n&&(n=!1),this.daysLoaded=0,this.emptyEventsTimes=0,this.coursesProvider.getUserCourses(!1).then(function(l){return l.unshift(t.allCourses),t.courses=l,t.fetchEvents(n)})},n.prototype.fetchEvents=function(n){var t=this;return void 0===n&&(n=!1),this.loadMoreError=!1,this.calendarProvider.getEventsList(this.daysLoaded,g.a.DAYS_INTERVAL).then(function(l){if(t.daysLoaded+=g.a.DAYS_INTERVAL,0===l.length){if(t.emptyEventsTimes++,!(t.emptyEventsTimes>5))return t.fetchEvents();t.canLoadMore=!1,n&&(t.events=[],t.filteredEvents=[])}else l.sort(function(n,t){return n.timestart==t.timestart?n.timeduration-t.timeduration:n.timestart-t.timestart}),l.forEach(t.calendarHelper.formatEventData.bind(t.calendarHelper)),t.getCategories=t.shouldLoadCategories(l),t.events=n?l:t.utils.mergeArraysWithoutDuplicates(t.events,l,"id"),t.filteredEvents=t.getFilteredEvents(),t.filteredEvents.forEach(function(n,l){n.showDate=t.showDate(n,t.filteredEvents[l-1]),n.endsSameDay=t.endsSameDay(n)}),t.canLoadMore=!0,t.calendarProvider.scheduleEventsNotifications(t.events);t.content.resize()}).catch(function(n){t.domUtils.showErrorModalDefault(n,"addon.calendar.errorloadevents",!0),t.loadMoreError=!0}).then(function(){if(t.getCategories)return t.getCategories=!1,t.loadCategories()})},n.prototype.loadMoreEvents=function(n){return this.fetchEvents().finally(function(){n&&n()})},n.prototype.getFilteredEvents=function(){return-1==this.filter.course.id?this.events:this.events.filter(this.shouldDisplayEvent.bind(this))},n.prototype.shouldDisplayEvent=function(n){if("user"==n.eventtype||"site"==n.eventtype)return!0;if("category"==n.eventtype){if(!n.categoryid||!Object.keys(this.categories).length)return!0;if(n.categoryid==this.filter.course.category)return!0;for(var t=this.categories[this.filter.course.category];t&&t.parent;){if(n.categoryid==t.parent)return!0;t=this.categories[t.parent]}return!1}return n.courseid===this.siteHomeId||n.courseid==this.filter.course.id},n.prototype.shouldLoadCategories=function(n){if(this.categoriesRetrieved||this.getCategories)return this.getCategories;return n.some(function(n){return"undefined"!=n.categoryid&&n.categoryid>0})||this.getCategories},n.prototype.loadCategories=function(){var n=this;return this.coursesProvider.getCategories(0,!0).then(function(t){n.categoriesRetrieved=!0,n.categories={},t.forEach(function(t){n.categories[t.id]=t})}).catch(function(){})},n.prototype.refreshEvents=function(n){var t=this,l=[];l.push(this.calendarProvider.invalidateEventsList()),this.categoriesRetrieved&&(l.push(this.coursesProvider.invalidateCategories(0,!0)),this.categoriesRetrieved=!1),Promise.all(l).finally(function(){t.fetchData(!0).finally(function(){n.complete()})})},n.prototype.showDate=function(n,t){return!t||!k(1e3*n.timestart).isSame(1e3*t.timestart,"day")},n.prototype.endsSameDay=function(n){return!n.timeduration||k(1e3*n.timestart).isSame(1e3*(n.timestart+n.timeduration),"day")},n.prototype.openCourseFilter=function(n){var t=this,l=this.popoverCtrl.create(D.a,{courses:this.courses,courseId:this.filter.course.id});l.onDidDismiss(function(n){n&&(t.filter.course=n,t.domUtils.scrollToTop(t.content),t.filteredEvents=t.getFilteredEvents())}),l.present({ev:n})},n.prototype.openSettings=function(){this.navCtrl.push("AddonCalendarSettingsPage")},n.prototype.gotoEvent=function(n){this.eventId=n,this.splitviewCtrl.push("AddonCalendarEventPage",{id:n})},n.prototype.ngOnDestroy=function(){this.obsDefaultTimeChange&&this.obsDefaultTimeChange.off()},n}(),S=function(){return function(){}}(),A=l(1365),M=l(1366),w=l(1367),R=l(1368),K=l(1369),F=l(1370),W=l(1371),N=l(1372),O=l(1373),H=l(1376),U=l(1377),j=l(1378),V=l(47),Y=l(44),z=l(7),B=l(28),G=l(19),J=l(46),q=l(117),Q=l(106),X=l(31),Z=l(21),nn=l(20),tn=l(29),ln=l(112),en=l(113),an=l(96),un=l(8),on=l(34),rn=l(42),sn=l(11),cn=l(15),dn=l(27),_n=l(6),fn=l(17),pn=l(18),hn=l(22),mn=l(26),vn=l(37),gn=l(88),bn=l(39),yn=l(32),En=l(231),In=l(24),Cn=l(447),xn=l(38),Dn=l(1374),Tn=l(207),Ln=l(33),$n=l(676),kn=l(1375),Pn=l(350),Sn=l(253),An=l(448),Mn=l(82),wn=l(71),Rn=l(66),Kn=l(70),Fn=l(83),Wn=l(75),Nn=l(449),On=l(67),Hn=l(178),Un=l(105),jn=l(141),Vn=l(195),Yn=l(147),zn=l(50),Bn=l(49),Gn=l(352),Jn=l(255),qn=l(64),Qn=f._14({encapsulation:2,styles:[],data:{}}),Xn=f._12("page-addon-calendar-list",P,function(n){return f._42(0,[(n()(),f._16(0,0,null,null,1,"page-addon-calendar-list",[],null,null,null,_,Qn)),f._15(1,180224,null,0,P,[G.a,g.a,qn.a,E.a,y.a,I.a,b.a,C.a,x.a,Rn.a,T.a,hn.a,L.a],null,null)],null,null)},{},{},[]),Zn=l(23),nt=l(346),tt=l(347),lt=l(349),et=l(348),it=l(446),at=l(675),ut=l(254);l.d(t,"AddonCalendarListPageModuleNgFactory",function(){return ot});var ot=f._13(S,[],function(n){return f._25([f._26(512,f.n,f._6,[[8,[A.a,M.a,w.a,R.a,K.a,F.a,W.a,N.a,O.a,H.a,U.a,j.a,Xn]],[3,f.n],f.B]),f._26(4608,un.m,un.l,[f.x,[2,un.v]]),f._26(4608,Zn.x,Zn.x,[]),f._26(4608,Zn.d,Zn.d,[]),f._26(4608,nt.b,nt.a,[]),f._26(4608,tt.a,tt.b,[]),f._26(4608,lt.b,lt.a,[]),f._26(4608,et.b,et.a,[]),f._26(4608,G.a,G.a,[it.a,nt.b,tt.a,lt.b,et.b,G.b,G.c]),f._26(512,un.b,un.b,[]),f._26(512,Zn.v,Zn.v,[]),f._26(512,Zn.i,Zn.i,[]),f._26(512,Zn.s,Zn.s,[]),f._26(512,at.a,at.a,[]),f._26(512,p.a,p.a,[]),f._26(512,m.a,m.a,[]),f._26(512,v.a,v.a,[]),f._26(512,h.a,h.a,[]),f._26(512,at.b,at.b,[]),f._26(512,S,S,[]),f._26(256,G.c,void 0,[]),f._26(256,G.b,void 0,[]),f._26(256,ut.a,P,[])])})}});